
import React, { Component } from "react";
import "./App.css";
import "./index.css";
import Axios from "axios";
import Navbar from "./components/Navbar";
import Topbar from './components/navigation/TopBar'
import AppContextProvider from "./contexts/AuthContext";
import { AuthContext } from "./contexts/AuthContext";


class App extends Component {
	static contextType = AuthContext;

	constructor() {
		super();
		this.state = {
			user: {
				id: "",
				username: "",
				role : ""
			},
		};
		this.handleWhoAmI = this.handleWhoAmI.bind(this);
		this.instanceRef = React.createRef();
	}

	handleWhoAmI(id) {
		this.setState({ user: { id: id } }, () => {
		});
	}

	componentDidMount() {
		Axios
			.get("/auth/whoami", {
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8;Access-Control-Allow-Origin:*'
				}
			})
			.then((response) => {
				if (response.data !== '') {
					const { id, username, role } = response.data
					const userObject = { id: id, username: username, role : role };
					this.setState({ user: userObject });
				} else {
					console.log("Status: " + response.status);
				}
			});
	}

	

	render() {
		return (
			<AppContextProvider>
				
				<Topbar storeId={this.handleWhoAmI} userObj={this.state.user}/>
				<Navbar storeId={this.handleWhoAmI} userObj={this.state.user} />
			</AppContextProvider>
		);
	}

}
export default App;
