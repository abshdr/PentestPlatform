import React, {useState, useEffect} from 'react'
import UploadService from '../../services/UploadService.jsx'

const UploadFiles = () => {
  const [selectedFiles, setSelectedFiles] = useState(undefined)
  const [currentFile, setCurrentFile] = useState(undefined)
  const [message, setMessage] = useState("")
  const [fileInfos, setFileInfos] = useState([])



  const selectFile = (event) => {
    setSelectedFiles(event.target.files)
  }

  useEffect(()=> {
    UploadService.getFiles().then((response)=>{
      console.log(response.data);
      setFileInfos(response.data)
    });
  },[]);

  const upload = () => {
    let currentFile = selectedFiles[0];
    setCurrentFile(currentFile);
    UploadService.upload(currentFile)
    .then((response)=> {
      setMessage(response.data.message);
      return UploadService.getFiles();
    })
    .then((files)=> {
      setFileInfos(files.data)
    })
    .catch(()=> {
      setMessage("Could not upload the file!");
      setCurrentFile(undefined);
    });
    setSelectedFiles(undefined)
  };







  return (
    <div>
      { currentFile && (
          <div>
            Uploaded
          </div>
        )
      }

      <label>
        <input type="file" onChange={selectFile} />
      </label>
      <button
        disabled={!selectedFiles}
        onClick={upload}
      >
        Upload
      </button>
      <div>
        {message}
      </div>

      <div>List Of Files</div>
      <ul>
        {fileInfos &&
          fileInfos.map((file, index) => (
            <li key={index}>
              {file.name}
            </li>
          ))}
      </ul>

    </div>
  )
}

export default UploadFiles;