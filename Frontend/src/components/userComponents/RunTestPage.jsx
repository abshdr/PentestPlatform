import React, { Component } from 'react'
import axios from 'axios'
import { Link } from "react-router-dom";
import '../../styles/RunTestPage.css'

export default class RunTestPage extends Component {
    constructor(props) {
        super(props);
        this.state = {
            projectId:window.location.href.substring(
				    window.location.href.lastIndexOf("/") + 1),
            testCases:[],
            scripts:[],
            searchPhrase:"",
            }
      this.searchPhraseChange = this.searchPhraseChange.bind(this);

    
    }
    searchPhraseChange(event) {
        this.setState({ searchPhrase: event.target.value });
      }
    componentDidMount(){
        this.loadTestCases();
    }
        loadTestCases(){
            axios
            .get("/rest/allTestcases")
            .then((response) => response.data)
            .then((data) => {
            this.setState({ testCases: data });
            console.log( this.state.testCases);
            });

        }

        loadScriptsByTestcase(id){
            axios
            .get("/rest/scripts/byTestCase/39" )
            .then((response) => response.data)
            .then((data) => {
            this.setState({ scripts: data });
            console.log( this.state.scripts);
            });
        }

        searchTestCases(){
          axios
          .get("localhost:3000/rest/testCase/search/" + this.state.searchPhrase)
          .then((response) => response.data)
            .then((data) => {
              this.setState({ testCases: data });
              console.log(this.state.testCases);
            });
        }




  render() {
    return (
      <div>
    <div className="searchBox">
        <div className="searchComponent">
          <div className="inputBar">
            <input type="text" placeholder='Search for a test case' value={this.state.searchPhrase} onChange={this.searchPhraseChange} /> 
          </div>
          
            <button id="searchButton" onClick={()=> {this.searchTestCases()}}>Search</button>
        </div>
        </div>

        

<div className="TestPageListLabelContainer">
<label id="testCaseTitleLabel">Title</label>
<label id="testCaseCreatedLabel">Created By:</label>
</div>       
 
{renderTestCases(this.state.testCases)}

      </div>
      
    )
  }
}

function renderTestCases(testCases){
  let testCaseValues = Object.values(testCases);
  
  let testCaseList =[];
  
  for (let i = 0; i < testCaseValues.length; i++){
    testCaseList.push(

      
      <div key={i} className="testCaseList">


      
        <Link to={`/scripts/${testCaseValues[i].id}`}>
        <div id="testCaseListItem">
          <span id="testCaseTitle">{testCaseValues[i].title}</span> <br />
          <span id="testCaseCreatorName">{testCaseValues[i].user.username}</span>
          
          </div> 
        </Link>{" "}
         </div>
    )
  }
  return testCaseList;
  }
