import React, { Component} from 'react'
import axios from 'axios'
import { Link } from "react-router-dom";
import '../../styles/SingleProject.css'
import {ReactComponent as DownloadReport} from '../../icons/DownloadReport.svg'
import {ReactComponent as DateProjectIcon} from '../../icons/DateProject.svg'


export default class SingleProject extends Component {
  constructor(props) {
    super(props);
    this.state = {
      userid:props.userId,
      projectId: window.location.href.substring(
				window.location.href.lastIndexOf("/") + 1
			),
      reports:[],
      project:{
      
        user:{
          username:"",

        }
      },
    }
  }


  
  componentDidMount() {
this.loadReports();
this.loadProjectInfo();
}
loadProjectInfo(){
  axios
    .get("http://localhost:8080/rest/projectById/" + this.state.projectId)
    .then((response) => response.data)
    .then((data) => {
      this.setState({ project: data });
      console.log("loaded project information by id", this.state.project)
    });
}

  loadReports(){
    axios
    .get("http://localhost:8080/rest/reports/byproject/" + this.state.projectId)
    .then((response) => response.data)
    .then((data) => {
      this.setState({ reports: data });
      console.log( this.state.reports);
    });
  }

  render() {
    return (
      <div className="mainpage" ><h1>{this.state.project.title}</h1>
        <div className="informationsPanel"> 
        <div className="ScanObject">
          <label>Scan object</label> <br />
          <span id="ScanObjectTitle">Styrportalen</span>
          </div>
        
        <div className="centerContainer"> 
        <div id="description">
          <label>Description</label> <br />
          <p>{this.state.project.description}</p>
          </div>
            <div id="creator">
            <label> Created by</label> <br />
            <span id="creatorStyle">{this.state.project.user.username}</span>
            </div>
        </div>
        
      </div>  

            <div className="runTestButtonContainer">
            
             <button id="runTestButton">  <Link to={`/runTest/${this.state.projectId}`}
             >Run new Test </Link></button> 
             
             <button id ="advandedButton">Advanced</button>

              </div>
           


      <div > <h2>Previous reports</h2>
      <div id="filtercontainer">
          <div id="dateContainer">Date</div>
          <div> Results</div>
        </div>
        <div className ="reportListContainer"></div>
        {renderReports(
          this.state.reports
        )}</div>


      </div>
    )
  }
}


function renderReports(reports){

  
let reportValues = Object.values(reports);
let url = "http://localhost:8080/rest/downloadReport/";
let reportList =[];

for (let i = 0; i < reportValues.length; i++){
    reportList.push(
    <div id="reportListItem" key={i} >
      <div id="dateContainer">
            <span>{reportValues[i].testExecutionDate}</span></div>	<br />
            <div id="resultContainer">
            <span>{reportValues[i].result}</span>	<br />

            </div>

          <div id="downloadContainer">
            <DownloadReport/>
            <a href={url + reportValues[i].id }> 
            Download report
            </a>
            </div>
  	
				 
          </div>
  )}

return reportList;
}
